filter {
    if [type] == "rsyslog_client" {
        if "pihole" in [tags] {
            grok {
#                match => { "message" => "^\<%{INT:priority}\>%{SYSLOGTIMESTAMP:ts} %{WORD:hostname} %{WORD:application}" }
                match => { "message" => "^\<%{INT:priority}\>%{SYSLOGTIMESTAMP:ts} %{WORD:hostname} %{WORD:application} %{DATA:ts2} dnsmasq\[21866\]\: %{WORD:action}(\[%{WORD:query_type}\])? %{NOTSPACE:domain} %{WORD:direction} (%{IPV4:ip})?" }
            }
        }
    }
}

output {
    if [type] == "rsyslog_client" {
        if "pihole" in [tags] {
            elasticsearch {
                hosts => ["localhost:9200"]
                index => "pihole-%{+YYYY.MM.dd}"
            }
        }
    }
}
